<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nöbet Fiyat</title>
    <link rel="stylesheet" href="styles.css">
    <!-- Firebase SDK'ları -->
    <script src="https://www.gstatic.com/firebasejs/9.20.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.20.0/firebase-firestore.js"></script>
    <script>
        // Firebase yapılandırma bilgilerinizi buraya ekleyin
        const firebaseConfig = {
            apiKey: "AIzaSyC035yNDCY-LKV_NHXxdDaJBcPM_HY_zW4",
            authDomain: "nobettakip-447bf.firebaseapp.com",
            projectId: "nobettakip-447bf",
            storageBucket: "nobettakip-447bf.appspot.com",
            messagingSenderId: "685407754980",
            appId: "1:685407754980:web:5e63808d0c36186afbaaf1",
            measurementId: "G-N36D0ST83P"
        };

        // Firebase'i başlat
        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Sayfa yüklendiğinde fiyatları getir
        window.onload = async () => {
            await fetchPrices();
        };

        // Fiyatları Firestore'dan çekme
        async function fetchPrices() {
            const priceList = document.getElementById('priceList');
            priceList.innerHTML = ''; // Önceki listeyi temizle

            const querySnapshot = await db.collection('prices').get();
            querySnapshot.forEach((doc) => {
                const data = doc.data();
                const li = document.createElement('li');
                li.textContent = `${data.date} - ${data.stock}: ${data.price} TL`;
                priceList.appendChild(li);
            });
            await calculateAveragePrice();
        }

        // Ortalama fiyatı hesaplama
        async function calculateAveragePrice() {
            const querySnapshot = await db.collection('prices').get();
            let total = 0;
            let count = 0;

            querySnapshot.forEach((doc) => {
                total += doc.data().price;
                count++;
            });

            const average = count > 0 ? (total / count).toFixed(2) : 0;
            document.getElementById('averagePrice').textContent = average + ' TL';
        }

        // Fiyat ekleme
        document.getElementById('priceForm').addEventListener('submit', async (event) => {
            event.preventDefault(); // Sayfanın yeniden yüklenmesini engelle

            const stock = document.getElementById('stock').value;
            const date = document.getElementById('date').value;
            const price = parseFloat(document.getElementById('price').value);

            await db.collection('prices').add({
                stock: stock,
                date: date,
                price: price
            });

            document.getElementById('message').textContent = 'Fiyat başarıyla eklendi!';
            await fetchPrices(); // Fiyatları yeniden çek
            document.getElementById('priceForm').reset(); // Formu sıfırla
        });

        // Geçmişi sıfırlama
        document.getElementById('resetButton').addEventListener('click', async () => {
            const password = document.getElementById('resetPassword').value;
            if (password === '79066540') { // Burada kendi şifrenizi koyun
                const querySnapshot = await db.collection('prices').get();
                querySnapshot.forEach(async (doc) => {
                    await db.collection('prices').doc(doc.id).delete();
                });
                document.getElementById('message').textContent = 'Geçmiş sıfırlandı!';
                await fetchPrices(); // Fiyatları yeniden çek
                document.getElementById('resetPassword').value = ''; // Şifre alanını sıfırla
            } else {
                document.getElementById('message').textContent = 'Yanlış şifre!';
            }
        });
    </script>
</head>
<body>
    <div class="container">
        <h1>Nöbet Fiyat</h1>
        <form id="priceForm">
            <label for="stock">Servis Seç:</label>
            <select id="stock" required>
                <option value="Acil">Acil</option>
                <option value="Acil (24 saat)">Acil (24 saat)</option>
                <option value="Pediatri">Pediatri</option>
                <option value="Pediatri (24 saat)">Pediatri (24 saat)</option>
                <option value="Genel Cerrahi">Genel Cerrahi</option>
                <option value="Genel Cerrahi (24 saat)">Genel Cerrahi (24 saat)</option>
                <option value="Dahiliye">Dahiliye</option>
                <option value="Dahiliye (24 saat)">Dahiliye (24 saat)</option>
                <option value="Kadın Doğum">Kadın Doğum</option>
                <option value="Kadın Doğum (24 saat)">Kadın Doğum (24 saat)</option>
                <option value="Seçmeli">Seçmeli</option>
                <option value="Seçmeli (24 saat)">Seçmeli (24 saat)</option>
            </select>

            <label for="date">Tarih (gg/aa/yyyy):</label>
            <input type="text" id="date" placeholder="dd/mm/yyyy" required>

            <label for="price">Fiyat:</label>
            <input type="number" id="price" step="0.01" required>

            <button type="submit">Ekle</button>
        </form>

        <h2>Geçmişi Sıfırlama</h2>
        <label for="resetPassword">Şifre:</label>
        <input type="password" id="resetPassword" placeholder="Şifre girin">
        <button id="resetButton">Geçmişi Sıfırla</button>

        <h2>Girdiğiniz Fiyatlar:</h2>
        <ul id="priceList"></ul>

        <h2>Ortalama Fiyat:</h2>
        <p id="averagePrice">0.00 TL</p>

        <p id="message" style="color: green;"></p> <!-- Başarı mesajı için alan -->
    </div>
</body>
</html>







