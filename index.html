<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nöbet Fiyat</title>
    <link rel="stylesheet" href="styles.css">

    <!-- Firebase SDK (App ve Firestore için) -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js"></script>

    <script>
      // Firebase config dosyanız (Firebase Console'dan alın)
      const firebaseConfig = {
  apiKey: "AIzaSyC035yNDCY-LKV_NHXxdDaJBcPM_HY_zW4",
  authDomain: "nobettakip-447bf.firebaseapp.com",
  projectId: "nobettakip-447bf",
  storageBucket: "nobettakip-447bf.appspot.com",
  messagingSenderId: "685407754980",
  appId: "1:685407754980:web:5e63808d0c36186afbaaf1",
  measurementId: "G-N36D0ST83P"
      };

      // Firebase'i başlatın
      firebase.initializeApp(firebaseConfig);

      // Firestore veritabanı örneğini alın
      const db = firebase.firestore();
    </script>
</head>
<body>
    <div class="container">
        <h1>Nöbet Fiyat</h1>
        <form id="priceForm">
            <label for="stock">Servis Seç:</label>
            <select id="stock" required>
                <option value="Acil">Acil</option>
                <option value="Acil (24 saat)">Acil (24 saat)</option>
                <option value="Pediatri">Pediatri</option>
                <option value="Pediatri (24 saat)">Pediatri (24 saat)</option>
                <option value="Genel Cerrahi">Genel Cerrahi</option>
                <option value="Genel Cerrahi (24 saat)">Genel Cerrahi (24 saat)</option>
                <option value="Dahiliye">Dahiliye</option>
                <option value="Dahiliye (24 saat)">Dahiliye (24 saat)</option>
                <option value="Kadın Doğum">Kadın Doğum</option>
                <option value="Kadın Doğum (24 saat)">Kadın Doğum (24 saat)</option>
                <option value="Seçmeli">Seçmeli</option>
                <option value="Seçmeli (24 saat)">Seçmeli (24 saat)</option>
            </select>

            <label for="date">Tarih (gg/aa/yyyy):</label>
            <input type="text" id="date" placeholder="dd/mm/yyyy" required>

            <label for="price">Fiyat:</label>
            <input type="number" id="price" step="0.01" required>

            <button type="submit">Ekle</button>
        </form>

        <h2>Geçmişi Sıfırlama</h2>
        <label for="resetPassword">Şifre:</label>
        <input type="password" id="resetPassword" placeholder="Şifre girin">
        <button id="resetButton">Geçmişi Sıfırla</button>

        <h2>Girdiğiniz Fiyatlar:</h2>
        <ul id="priceList"></ul>

        <h2>Ortalama Fiyat:</h2>
        <p id="averagePrice">0.00</p>
    </div>

    <script>
      // Formu işleyelim ve Firebase'e veri ekleyelim
      document.getElementById('priceForm').addEventListener('submit', function(e) {
        e.preventDefault(); // Sayfanın yenilenmesini engelle

        // Formdan veri al
        const stock = document.getElementById('stock').value;
        const date = document.getElementById('date').value;
        const price = parseFloat(document.getElementById('price').value);

        // Firebase Firestore'a veriyi ekle
        db.collection("prices").add({
          stock: stock,
          date: date,
          price: price,
          timestamp: firebase.firestore.FieldValue.serverTimestamp()
        })
        .then(() => {
          console.log("Veri başarıyla eklendi!");
          document.getElementById('priceForm').reset(); // Formu sıfırla
          loadPrices(); // Verileri yeniden yükle
        })
        .catch((error) => {
          console.error("Hata oluştu: ", error);
        });
      });

      // Verileri çekme ve ekranda gösterme
      function loadPrices() {
        db.collection("prices").orderBy("timestamp", "desc").get().then((querySnapshot) => {
          const priceList = document.getElementById('priceList');
          priceList.innerHTML = ''; // Listeyi temizle

          let total = 0;
          let count = 0;

          querySnapshot.forEach((doc) => {
            const data = doc.data();
            const priceItem = document.createElement('li');
            priceItem.textContent = `${data.date} - ${data.stock}: ${data.price.toFixed(2)} TL`;
            priceList.appendChild(priceItem);

            // Ortalama fiyat hesapla
            total += data.price;
            count++;
          });

          const averagePrice = (count > 0) ? (total / count).toFixed(2) : 0;
          document.getElementById('averagePrice').textContent = `${averagePrice} TL`;

        }).catch((error) => {
          console.error("Veriler yüklenirken hata oluştu: ", error);
        });
      }

      // Sayfa yüklendiğinde verileri çek
      window.onload = loadPrices;

      // Geçmişi sıfırlama
      document.getElementById('resetButton').addEventListener('click', function() {
        const password = document.getElementById('resetPassword').value;
        if (password === '79066540') { // Sıfırlama için basit bir şifre doğrulaması
          db.collection("prices").get().then((querySnapshot) => {
            querySnapshot.forEach((doc) => {
              db.collection("prices").doc(doc.id).delete().then(() => {
                console.log("Veri başarıyla silindi!");
                loadPrices(); // Verileri güncelle
              }).catch((error) => {
                console.error("Silme hatası: ", error);
              });
            });
          }).catch((error) => {
            console.error("Veri okuma hatası: ", error);
          });
        } else {
          alert("Yanlış şifre!");
        }
      });
    </script>

</body>
</html>


